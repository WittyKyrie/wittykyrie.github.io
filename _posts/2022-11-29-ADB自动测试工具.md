---
title: ADB自动测试工具
author: wittykyrie
date: 2022-11-29 09:00:00 +0800
categories: ['ADB']
tags: ['adb','Android']
render_with_liquid: false
---

目的是因为游戏发包时，可能由于更改了SDK导致游戏稳定性变差，会导致Crash或者[ANR](https://developer.android.com/topic/performance/vitals/anr)的出现,因此需要制作一款工具去完成自动打开应用并根据关键信息收集日志的工具。

## ADB需要用的指令

```
adb devices //检查是否有设备进行连接
```

**启动Android App**
```
adb shell am start -n [PACKAGE-NAME]/[ACTIVITY-NAME]
```
其中`PACKAGE-NAME`的参数部分，也就是App的package name，也可以透过以下的指令来进行查看
```
adb shell pm list packages （-s：列出系统应用包名  -3：列出第三方应用包名 -f：列出应用包名及对应的apk名及存放位置  -i：列出应用包名及其安装来源）
```
接着`ACTIVITY-NAME`可以通过以下指令查看，当前运行App的Activity的名称。
```
adb shell dumpsys activity
```
举个例子，假设手机里装上了一款“元气骑士”，我们通过更改上面提到的例子，得到了游戏的包体名称“com.knight.union.bili”，接着我们打开元气骑士的App后，执行`adb shell dumpsys activity`指令，我们在输出的log中寻找包体的关键字，就可以找到如下关键字`com.knight.union.bili/com.chillyroomsdk.bilibili.PrivacyActivity`这个关键字就是我们当前游戏初始画面的Activity了。

所以结合上面的几个代码，我们就可以通过下面这一行的指令顺利的启动我们的App。
```
adb shell am start -n com.knight.union.bili/com.chillyroomsdk.bilibili.PrivacyActivity
```

**获取界面UI控件信息并模拟点击**

可以在Python当中导入Poco库，Poco库当中封装好了一些定位UI的方法,最常用方便的是用Text来进行定位

```python
from poco.drivers.android.uiautomation import AndroidUiautomationPoco

if __name__ == '__main__':
    poco(text="元气骑士").click()
```

>有时候会遇到`devices lineoff`的情况，一般用重启手机设备，或重启adb server的方式可以解决
{: .prompt-warning }

参考文章：
1. [如何使用Adb-command-line启动AndroidApp](https://kkboxsqa.wordpress.com/2014/08/20/%E5%A6%82%E4%BD%95%E9%80%8F%E9%81%8E-adb-command-line-%E6%8C%87%E4%BB%A4%E5%95%9F%E5%8B%95-android-app/)
2. [Android原生App UIPoco库](https://github.com/xiaocong/uiautomator#basic-api-usages)