<!DOCTYPE html><html lang="zh" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="ADB自动测试工具" /><meta name="author" content="Witty Kyrie" /><meta property="og:locale" content="zh" /><meta name="description" content="目的是因为游戏发包时，可能由于更改了SDK导致游戏稳定性变差，会导致Crash或者ANR的出现,因此需要制作一款工具去完成自动打开应用并根据关键信息收集日志的工具。" /><meta property="og:description" content="目的是因为游戏发包时，可能由于更改了SDK导致游戏稳定性变差，会导致Crash或者ANR的出现,因此需要制作一款工具去完成自动打开应用并根据关键信息收集日志的工具。" /><link rel="canonical" href="https://wittykyrie.github.io/posts/ADBAutoTestTool/" /><meta property="og:url" content="https://wittykyrie.github.io/posts/ADBAutoTestTool/" /><meta property="og:site_name" content="Witty" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-11-29T09:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="ADB自动测试工具" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Kyrie" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Witty Kyrie","url":"https://github.com/WittyKyrie?tab=repositories"},"dateModified":"2022-11-29T09:00:00+08:00","datePublished":"2022-11-29T09:00:00+08:00","description":"目的是因为游戏发包时，可能由于更改了SDK导致游戏稳定性变差，会导致Crash或者ANR的出现,因此需要制作一款工具去完成自动打开应用并根据关键信息收集日志的工具。","headline":"ADB自动测试工具","mainEntityOfPage":{"@type":"WebPage","@id":"https://wittykyrie.github.io/posts/ADBAutoTestTool/"},"url":"https://wittykyrie.github.io/posts/ADBAutoTestTool/"}</script><title>ADB自动测试工具 | Witty</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Witty"><meta name="application-name" content="Witty"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://i.postimg.cc/PNGcnHyd/avator.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Witty</a></div><div class="site-subtitle font-italic">关于我游戏开发的Blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/Witty" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['649547021','qq.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>ADB自动测试工具</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>ADB自动测试工具</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1669683600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Nov 29, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/WittyKyrie?tab=repositories">Witty Kyrie</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1207 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><p>目的是因为游戏发包时，可能由于更改了SDK导致游戏稳定性变差，会导致Crash或者<a href="https://developer.android.com/topic/performance/vitals/anr">ANR</a>的出现,因此需要制作一款工具去完成自动打开应用并根据关键信息收集日志的工具。</p><h2 id="adb需要用的指令"><span class="mr-2">ADB需要用的指令</span><a href="#adb需要用的指令" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>adb devices //检查是否有设备进行连接
</pre></table></code></div></div><p><strong>启动Android App</strong></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>adb shell am start -n [PACKAGE-NAME]/[ACTIVITY-NAME]
</pre></table></code></div></div><p>其中<code class="language-plaintext highlighter-rouge">PACKAGE-NAME</code>的参数部分，也就是App的package name，也可以透过以下的指令来进行查看</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>adb shell pm list packages （-s：列出系统应用包名  -3：列出第三方应用包名 -f：列出应用包名及对应的apk名及存放位置  -i：列出应用包名及其安装来源）
</pre></table></code></div></div><p>接着<code class="language-plaintext highlighter-rouge">ACTIVITY-NAME</code>可以通过以下指令查看，当前运行App的Activity的名称。</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>adb shell dumpsys activity
</pre></table></code></div></div><p>举个例子，假设手机里装上了一款“元气骑士”，我们通过更改上面提到的例子，得到了游戏的包体名称“com.knight.union.bili”，接着我们打开元气骑士的App后，执行<code class="language-plaintext highlighter-rouge">adb shell dumpsys activity</code>指令，我们在输出的log中寻找包体的关键字，就可以找到如下关键字<code class="language-plaintext highlighter-rouge">com.knight.union.bili/com.chillyroomsdk.bilibili.PrivacyActivity</code>这个关键字就是我们当前游戏初始画面的Activity了。</p><p>所以结合上面的几个代码，我们就可以通过下面这一行的指令顺利的启动我们的App。</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>adb shell am start -n com.knight.union.bili/com.chillyroomsdk.bilibili.PrivacyActivity
</pre></table></code></div></div><p><strong>获取界面UI控件信息并模拟点击</strong></p><p>可以在Python当中导入Poco库，Poco库当中封装好了一些定位UI的方法,最常用方便的是用Text来进行定位</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">poco.drivers.android.uiautomation</span> <span class="kn">import</span> <span class="n">AndroidUiautomationPoco</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">poco</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">"元气骑士"</span><span class="p">).</span><span class="n">click</span><span class="p">()</span>
</pre></table></code></div></div><blockquote class="prompt-warning"><div><p>有时候会遇到<code class="language-plaintext highlighter-rouge">devices lineoff</code>的情况，一般用重启手机设备，或重启adb server的方式可以解决</p></div></blockquote><p>除此之外，网易所提供的<a href="https://github.com/AirtestProject/Airtest">Airtest工具</a>也提供了一个完整的自动测试环境来协助我们对设备进行UI层面的控制。</p><p><strong>使用Python制作的完整的监控关键词工具</strong></p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">LOG_PATH</span> <span class="o">=</span> <span class="s">""</span>

<span class="n">KEYWORDS</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">STOP_LOGCAT</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">INSTRUCTION</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"1"</span><span class="p">:</span> <span class="s">"filter_keywords"</span><span class="p">,</span>
    <span class="s">"2"</span><span class="p">:</span> <span class="s">"stop_filter_keywords"</span><span class="p">,</span>
    <span class="s">"3"</span><span class="p">:</span> <span class="s">"exit"</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">filter_keywords</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">STOP_LOGCAT</span>
    <span class="n">STOP_LOGCAT</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="n">get_devices</span><span class="p">()</span>  <span class="c1"># 先获取所有连接的设备
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"开始监控关键字"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">filter_keyword</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">device</span><span class="p">,))</span>
        <span class="n">t</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">stop_filter_keywords</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">STOP_LOGCAT</span>
    <span class="k">if</span> <span class="n">STOP_LOGCAT</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"没有正在执行的任务</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">STOP_LOGCAT</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"正在停止关键字监控</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">filter_keyword</span><span class="p">(</span><span class="n">device</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"设备%s关键字监控已开启"</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">device</span><span class="p">))</span>
    <span class="n">sub</span> <span class="o">=</span> <span class="n">logcat</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">sub</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sub</span><span class="p">.</span><span class="n">stdout</span><span class="p">:</span>  <span class="c1"># 子进程会持续输出日志，对子进程对象.stdout进行循环读取
</span>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">KEYWORDS</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">).</span><span class="n">find</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="s">"设备：%s 检测到：%s 日志信息：%s</span><span class="se">\n</span><span class="s">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">get_log_path</span><span class="p">(</span><span class="s">"bugreport"</span><span class="p">)</span>
                    <span class="n">bugreport</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">STOP_LOGCAT</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"设备%s关键字监控已停止"</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">device</span><span class="p">))</span>
        <span class="n">sub</span><span class="p">.</span><span class="n">kill</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">logcat</span><span class="p">(</span><span class="n">device</span><span class="p">):</span>
    <span class="n">command</span> <span class="o">=</span> <span class="s">"adb logcat -c"</span>
    <span class="n">subprocess</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

    <span class="n">command</span> <span class="o">=</span> <span class="s">"adb -s "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="o">+</span> <span class="s">" logcat -v time *:W"</span>
    <span class="n">sub</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sub</span>


<span class="k">def</span> <span class="nf">get_devices</span><span class="p">():</span>
    <span class="n">command</span> <span class="o">=</span> <span class="s">"adb devices"</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">popen</span><span class="p">(</span><span class="n">command</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">"device"</span><span class="p">):</span>
            <span class="n">devices</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'</span><span class="se">\t</span><span class="s">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">devices</span>


<span class="k">def</span> <span class="nf">bugreport</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="n">os</span><span class="p">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">'%Y'</span><span class="p">)</span>
    <span class="n">month</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">'%m'</span><span class="p">)</span>
    <span class="n">day</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">'%d'</span><span class="p">)</span>

    <span class="n">command</span> <span class="o">=</span> <span class="s">"adb -s "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="o">+</span> <span class="s">" bugreport"</span>
    <span class="n">subprocess</span><span class="p">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">bufsize</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"设备：%s 日志路径：%s"</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">path</span><span class="p">))</span>

    <span class="n">keyword_logcat</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"keyword_logcat%s-%s-%s.txt"</span> <span class="o">%</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">),</span> <span class="s">"a"</span><span class="p">)</span>
    <span class="n">keyword_logcat</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="n">keyword_logcat</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">get_log_path</span><span class="p">(</span><span class="n">tag</span><span class="p">):</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">'%Y'</span><span class="p">)</span>
    <span class="n">month</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">'%m'</span><span class="p">)</span>
    <span class="n">day</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">'%d'</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">LOG_PATH</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="s">"%s %s %s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path</span>


<span class="k">def</span> <span class="nf">read_config</span><span class="p">():</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'SDKTestConfig.json'</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">'KEYWORDS'</span><span class="p">]:</span>
        <span class="n">KEYWORDS</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s">'word'</span><span class="p">])</span>

    <span class="k">global</span> <span class="n">LOG_PATH</span>
    <span class="n">LOG_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'LOG_PATH'</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="n">LOG_PATH</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">read_config</span><span class="p">()</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"-"</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"1：开启关键字监控  2：停止关键字监控  3:exit"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"-"</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">instruction</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">请输入要进行的操作号:"</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"-"</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">instruction</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">INSTRUCTION</span><span class="p">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">instruction</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">输入无效，请重新输入:"</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">instruction</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">stop_filter_keywords</span><span class="p">()</span>
            <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># exit()
</span>        <span class="nb">eval</span><span class="p">(</span><span class="n">INSTRUCTION</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">instruction</span><span class="p">)]</span> <span class="o">+</span> <span class="s">"()"</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>

</pre></table></code></div></div><p>以下是Json的配置文件，主要配置关键词以及logcat的输出路径</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"KEYWORDS"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nl">"word"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ANR"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nl">"word"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"NullPointerException"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nl">"word"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"CRASH"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nl">"word"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Force Closed"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nl">"word"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ab"</span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">

    </span><span class="nl">"LOG_PATH"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"C:</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">Administrator</span><span class="se">\\</span><span class="s2">Desktop</span><span class="se">\\</span><span class="s2">SDKTestTool"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>参考文章：</p><ol><li><a href="https://kkboxsqa.wordpress.com/2014/08/20/%E5%A6%82%E4%BD%95%E9%80%8F%E9%81%8E-adb-command-line-%E6%8C%87%E4%BB%A4%E5%95%9F%E5%8B%95-android-app/">如何使用Adb-command-line启动AndroidApp</a><li><a href="https://github.com/xiaocong/uiautomator#basic-api-usages">Android原生App UIPoco库</a></ol></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/adb/'>ADB</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/adb/" class="post-tag no-text-decoration" >adb</a> <a href="/tags/android/" class="post-tag no-text-decoration" >Android</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=ADB%E8%87%AA%E5%8A%A8%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7+-+Witty&url=https%3A%2F%2Fwittykyrie.github.io%2Fposts%2FADBAutoTestTool%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=ADB%E8%87%AA%E5%8A%A8%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7+-+Witty&u=https%3A%2F%2Fwittykyrie.github.io%2Fposts%2FADBAutoTestTool%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fwittykyrie.github.io%2Fposts%2FADBAutoTestTool%2F&text=ADB%E8%87%AA%E5%8A%A8%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7+-+Witty" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/%E5%8F%8D%E5%B0%84/">反射 Reflection</a><li><a href="/posts/MenuItem/">Unity Eitor扩展 -- MenuItem</a><li><a href="/posts/Factor-Pattern/">游戏设计模式之工厂模式</a><li><a href="/posts/MetaFile/">Meta文件详解</a><li><a href="/posts/AssetBundleAddressableResources%E8%B5%84%E6%BA%90/">Addressable介绍以及使用</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/adb/">adb</a> <a class="post-tag" href="/tags/addressable/">Addressable</a> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/assetbundle/">AssetBundle</a> <a class="post-tag" href="/tags/c/">c#</a> <a class="post-tag" href="/tags/class/">Class</a> <a class="post-tag" href="/tags/dependency-injection/">Dependency Injection</a> <a class="post-tag" href="/tags/electron/">electron</a> <a class="post-tag" href="/tags/file/">file</a> <a class="post-tag" href="/tags/fixupdate/">FixUpdate</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/%E5%8F%8D%E5%B0%84/"><div class="card-body"> <em class="small" data-ts="1677459600" data-df="ll" > Feb 27, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>反射 Reflection</h3><div class="text-muted small"><p> 反射(Reflection)的概念 反射(Reflection)是一种在运行时获取类型信息、动态创建对象、调用方法等操作的机制。在Unity开发过程中，使用反射(Reflection)可以使代码更加灵活和可扩展，例如动态创建对象、动态调用方法和插件化开发等场景。 反射(Reflection)的好处与坏处 反射(Reflection)是一种强大的机制，可以提高代码的灵活性和可扩展性。但是...</p></div></div></a></div><div class="card"> <a href="/posts/Factor-Pattern/"><div class="card-body"> <em class="small" data-ts="1676854800" data-df="ll" > Feb 20, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>游戏设计模式之工厂模式</h3><div class="text-muted small"><p> 当我们开发游戏时，我们通常需要创建大量的对象。有时候我们需要手动创建这些对象，但是这种方式容易出现错误，而且难以维护和扩展。在这种情况下，工厂模式就变得非常有用。 工厂模式是一种创建型设计模式，用于创建对象，将对象的创建过程封装在一个类中，以便在需要时创建对象。工厂模式可以通过将客户端代码与实际创建对象的过程分离来提高代码的可维护性、可扩展性和可读性。 在游戏开发中，工厂模式通常用于创建...</p></div></div></a></div><div class="card"> <a href="/posts/%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%94%B9%E8%84%9A%E6%9C%AC%E5%86%85%E5%AE%B9%E7%9A%84%E6%80%9D%E8%B7%AF/"><div class="card-body"> <em class="small" data-ts="1675904400" data-df="ll" > Feb 9, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Unity自动生成脚本</h3><div class="text-muted small"><p> 功能实现思路 在开发过程当中可能会遇到繁复的修改脚本的操作，有时我们希望可以通过自动化修改脚本内容来避免犯一些人为可能会犯的错误。 因此我们希望将增添删除代码的具体内容抽象成一个工具，然后交给非程序的人员也可以进行编写。 在确认完需求之后一般我们会将这个工具定位成三步。 读取需要修改的脚本文件，以字符串的方式 正则表达式定位字符串需要修改的位置，通过字符串操作对文本进行拆分，...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/MenuItem/" class="btn btn-outline-primary" prompt="Older"><p>Unity Eitor扩展 -- MenuItem</p></a> <a href="/posts/HashCode/" class="btn btn-outline-primary" prompt="Newer"><p>HashCode</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">Witty</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/adb/">adb</a> <a class="post-tag" href="/tags/addressable/">Addressable</a> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/assetbundle/">AssetBundle</a> <a class="post-tag" href="/tags/c/">c#</a> <a class="post-tag" href="/tags/class/">Class</a> <a class="post-tag" href="/tags/dependency-injection/">Dependency Injection</a> <a class="post-tag" href="/tags/electron/">electron</a> <a class="post-tag" href="/tags/file/">file</a> <a class="post-tag" href="/tags/fixupdate/">FixUpdate</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/zh.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
